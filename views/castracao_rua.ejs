<%- include("_header") -%>

<main class="container mt-4 mb-5">
    <section class="card shadow-sm">
        <div class="card-header bg-primary text-white">
            <h1 class="h4 mb-0">Castração de Pets de Rua</h1>
        </div>
        <fieldset class="card-body">
            <legend class="card-title h5">IMPORTANTE</legend>
            <p class="card-text">
                <p>Este formulário é para castração de animais de rua/protetores.</p>
                <p>Levar a partir das 08h30 da manhã e buscar à tarde ou no horário combinado na clínica!</p>
                <p>Fazer jejum com a ração a partir das 23h do dia anterior.</p>
                <p>Tomar água à vontade.</p>
                <p>Gatos levar na caixa de transporte e cães na coleira.</p>
            </p>
        </fieldset>
    </section>

    <% if (error && error.length) { %>
        <div class="alert alert-danger mt-3"><%= error %></div>
    <% } %>
    <% if (success && success.length) { %>
        <div class="alert alert-success mt-3"><%= success %></div>
    <% } %>

    <section class="card shadow-sm mt-3">
        <div class="card-body">
            <form action="/castracao/form" method="POST" id="formInscricao">
                <input type="hidden" name="tipo_castracao" value="pets_rua">
                
                <!-- Dados do Responsável -->
                <div class="row mb-3">
                    <div class="col-12">
                        <h4>Dados do Responsável</h4>
                    </div>
                </div>

                <div class="row g-2 mb-4">
                    <div class="col-md-4">
                        <label class="form-label fw-bold">Nome do Tutor *</label>
                        <input type="text" name="nome" class="form-control" placeholder="Nome completo do tutor" required>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label fw-bold">Telefone *</label>
                        <input type="tel" name="contato" id="contato" class="form-control phone-input" placeholder="Telefone com DDD" required>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label fw-bold">Disponível no WhatsApp?</label>
                        <select name="whatsapp" id="whatsapp" class="form-select">
                            <option value="" selected disabled>Selecione...</option>
                            <option value="sim">Sim</option>
                            <option value="nao">Não</option>
                        </select>
                    </div>
                </div>

                <div class="row g-2 mb-4">
                    <div class="col-md-4">
                        <label class="form-label fw-bold">Localidade (Bairro)</label>
                        <input type="text" name="locality" id="locality" class="form-control" placeholder="Bairro">
                    </div>
                </div>

                <!-- Dados dos Pets -->
                <div class="row mb-3 mt-4">
                    <div class="col-12">
                        <h4>Dados dos Pets</h4>
                        <p class="text-muted">Cada pet cadastrado será agendado para castração.</p>
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="col-12">
                        <h5>Adicionar Novo Pet</h5>
                    </div>
                </div>

                <div class="pet-card border rounded p-3 mb-3" id="petForm">
                    <div class="row g-2">
                        <div class="col-md-3">
                            <label class="form-label">Nome do Pet *</label>
                            <input type="text" name="pet_nome" id="petNome" class="form-control">
                        </div>
                        <div class="col-md-2">
                            <label class="form-label">Espécie *</label>
                            <select name="pet_especie" id="petEspecie" class="form-select">
                                <option value="">Selecione...</option>
                                <option value="gato">Gato</option>
                                <option value="cachorro">Cachorro</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <label class="form-label">Sexo *</label>
                            <select name="pet_sexo" id="petSexo" class="form-select">
                                <option value="">Selecione...</option>
                                <option value="macho">Macho</option>
                                <option value="femea">Fêmea</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <label class="form-label">Porte *</label>
                            <select name="pet_porte" id="petPorte" class="form-select">
                                <option value="">Selecione...</option>
                                <option value="pequeno">Pequeno</option>
                                <option value="medio">Médio</option>
                                <option value="grande">Grande</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <label class="form-label">Idade (anos)</label>
                            <input type="number" name="pet_idade" id="petIdade" class="form-control" placeholder="Ex: 2" min="0">
                        </div>
                    </div>
                    <!-- Clínica e Dia Preferencial -->
                    <div class="row g-2 mb-4 mt-2">
                        <div class="col-md-6">
                            <label for="clinica" class="form-label fw-bold">Clínica *</label>
                            <select class="form-select" id="clinica" name="clinica" required>
                                <option value="" selected disabled>Selecione uma clínica...</option>
                                <% if (typeof clinicas !== 'undefined' && clinicas.length > 0) { %>
                                    <% clinicas.forEach(function(clinica) { %>
                                        <option value="<%= clinica.nome %>"><%= clinica.nome %></option>
                                    <% }); %>
                                <% } %>
                                <% if(user) { %>
                                <option value="__nova_clinica__">Cadastrar nova clínica...</option>
                                <% } %>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="agenda" class="form-label fw-bold">Dia Preferencial para Agendamento *</label>
                            <select name="agenda" id="agenda" class="form-select" required>
                                <option value="" selected disabled>Selecione...</option>
                                <option value="segunda-feira">Segunda-feira</option>
                                <option value="terça-feira">Terça-feira</option>
                                <option value="quarta-feira">Quarta-feira</option>
                                <option value="quinta-feira">Quinta-feira</option>
                                <option value="sexta-feira">Sexta-feira</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Pets Cadastrados (Tabela) -->
                <div class="row mb-3">
                    <div class="col-12">
                        <h5>Pets Cadastrados (<span id="petCount">0</span>)</h5>
                        <div id="petsTableContainer" class="table-responsive border rounded" style="max-height: 300px; overflow-y: auto;">
                            <div id="petsSummary" class="p-3 text-muted text-center">
                                <i class="bi bi-paw" style="font-size: 2rem;"></i>
                                <p>Nenhum pet cadastrado ainda. Adicione os pets acima.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="petsDataContainer"></div>

                <!-- Botões -->
                <div class="row mb-3 mt-4 pt-3 border-top">
                    <div class="col-md-6">
                        <button type="button" class="btn btn-outline-primary" id="btnAddPet">
                            <i class="bi bi-plus-circle"></i> Adicionar Pet
                        </button>
                        <button type="button" class="btn btn-outline-danger ms-2" id="btnClearForm" style="display: none;">
                            <i class="bi bi-x-circle"></i> Limpar Formulário
                        </button>
                    </div>
                    <div class="col-md-6 text-end">
                        <a href="/castracao" class="btn btn-outline-secondary me-2">
                            <i class="bi bi-x-lg"></i> Cancelar
                        </a>
                        <button type="submit" class="btn btn-primary" id="btnSubmit">
                            <i class="bi bi-check-lg"></i> Solicitar Agendamento
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </section>

    <div class="text-center mt-4 mb-3">
        <a href="/castracao/lista" class="btn btn-outline-secondary">
            <i class="bi bi-card-list"></i> Ver Lista de Agendamentos
        </a>
    </div>
</main>

<script src="/static/js/castracao_baixo_custo.js"></script>

<%- include("_footer") -%>
