 <link rel="stylesheet" href="/static/css/relatorio.css">
<%- include("_header") -%>

<%- include("_footer") -%>

<div class="relatorio-container">
      <!-- Seletor de Tabelas do Banco de Dados -->
      <div class="selector-section">
          <h2 class="mb-3"><i class="bi bi-database me-2"></i>Selecionar Tabela</h2>
          <p class="text-muted">Escolha uma tabela do banco de dados para visualizar os dados</p>
          
          <div class="mb-3">
              <label for="tableSelect" class="form-label">Tabelas do Banco de Dados:</label>
              <select class="form-select" id="tableSelect" onchange="window.location.href='/relatorio/' + this.value">
                  <option value="">-- Selecione uma tabela --</option>
                  <% if (typeof todasTabelas !== 'undefined' && todasTabelas.length > 0) { %>
                      <% todasTabelas.forEach(function(table) { %>
                          <option value="<%= table %>" <%= (typeof tabela !== 'undefined' && tabela === table) ? 'selected' : '' %>>
                              <%= table %>
                          </option>
                      <% }); %>
                  <% } %>
              </select>
          </div>
      </div>

      
     <!-- Seção de Dados -->
     <% if (typeof tabela !== 'undefined' && tabela) { %>
         <div class="data-section">
             <div class="section-header">
                 <div>
                     <h1 class="section-title">
                         <% 
                         const reportTitles = {
                             'adocao': 'Adoção',
                             'adotante': 'Adotantes', 
                             'adotado': 'Adotados',
                             'castracao': 'Castração',
                             'procura_se': 'Procura-se',
                             'parceria': 'Parcerias',
                             'voluntario': 'Voluntários',
                             'interesse_voluntario': 'Interesse Voluntariado',
                             'interessados_adocao': 'Interesse Adoção',
                             'coleta': 'Coleta',
                             'login': 'Acessos ao Sistema'
                         };
                         const title = reportTitles[tabela] || tabela.charAt(0).toUpperCase() + tabela.slice(1);
                         %>
                         <i class="bi bi-database me-2"></i><%= title %>
                     </h1>
                 </div>
                 <div>
                     <span class="badge bg-light text-dark">
                         <%= typeof model !== 'undefined' && model.length ? model.length + ' registros' : '0 registros' %>
                     </span>
                 </div>
             </div>
             
             <% if (typeof model !== 'undefined' && model.length > 0) { %>
                 <div style="overflow-x: auto;">
                     <table class="table-modern">
                         <thead>
                             <% if (model.length > 0) { %>
                                 <tr>
                                     <% const firstItem = model[0]; %>
                                     <% for (const key in firstItem) { %>
                                         <th>
                                             <%= key.charAt(0).toUpperCase() + key.slice(1).replace(/_/g, ' ') %>
                                         </th>
                                     <% } %>
                                     <th style="text-align: center; min-width: 100px;">Ações</th>
                                 </tr>
                             <% } %>
                         </thead>
                         <tbody>
                              <% for (const item of model) { %>
                                  <tr>
                                      <% for (const key in item) { %>
                                          <td><%= item[key] || '-' %></td>
                                      <% } %>
                                      <td>
                                          <% if (item.id) { %>
                                          <div class="action-buttons">
                                              <form action="/relatorio/delete/<%= tabela %>/<%= item.id %>?_method=DELETE" method="POST" style="margin: 0;">
                                                  <button type="submit" class="btn-action btn-delete" title="Excluir Registro" onclick="return confirm('Tem certeza que deseja excluir este registro? Esta ação não pode ser desfeita.')">
                                                      <i class="bi bi-trash"></i>
                                                  </button>
                                              </form>
                                          </div>
                                          <% } else { %>
                                          <span class="text-muted">-</span>
                                          <% } %>
                                      </td>
                                  </tr>
                              <% } %>
                         </tbody>
                     </table>
                 </div>
             <% } else { %>
                 <div class="empty-state">
                     <i class="bi bi-inbox"></i>
                     <h3>Nenhum Dado Encontrado</h3>
                     <p>Não há registros disponíveis para o relatório selecionado.</p>
                 </div>
             <% } %>
         </div>
         
         <!-- Seção de Exportação -->
         <% if (typeof model !== 'undefined' && model.length > 0) { %>
             <div class="export-section">
                 <form action="/relatorio/<%= tabela %>" method="post" style="margin: 0;">
                     <button type="submit" class="btn-export btn-pdf" onclick="return confirm('Gerar relatório PDF com todos os dados?');">
                         <i class="bi bi-file-earmark-pdf"></i>
                         Gerar Relatório PDF
                     </button>
                 </form>
                 
                 <a href="javascript:history.back()" class="btn-export" style="background: var(--button-bg); color: var(--button-text);">
                     <i class="bi bi-arrow-left"></i>
                     Voltar
                 </a>
             </div>
         <% } %>
     <% } else { %>
         <div class="data-section">
             <div class="empty-state">
                 <i class="bi bi-graph-up"></i>
                 <h3>Selecione um Relatório</h3>
                 <p>Escolha uma das opções acima para visualizar os dados correspondentes.</p>
             </div>
         </div>
     <% } %>
</div>

<script src="/static/js/relatorio.js"></script>

<%- include("_footer") -%>
 