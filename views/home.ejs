  <%-include("_header")-%>

  <main class="main-content">


     <% if (typeof errorLoadingData !== 'undefined' && errorLoadingData) { %>
         <div class="alert alert-danger" role="alert">
             Ocorreu um erro ao carregar alguns dados da página. Por favor, tente novamente mais tarde.
         </div>
     <% } %>

     <% if (success_msg) { %>
         <div class="alert alert-success alert-dismissible fade show" role="alert">
             <%= success_msg %>

     <% } %>

         </div>

      <!-- ==========================================================================
          1. Hero Section (Destaque Principal)
          ========================================================================== -->
      <section class="hero-section text-center py-5" style="background: linear-gradient(rgba(0,0,0,0.4), rgba(0,0,0,0.4)), url('/static/css/imagem/ong_hero_background.jpg') no-repeat center center; background-size: cover;">
          <div class="container" style="background-color: transparent; box-shadow: none; border: none;">
              <h1 style="color: white; font-size: 2.8em; text-shadow: 2px 2px 4px rgba(0,0,0,0.7);">Amor que Transforma Vidas</h1>
              <p style="color: #f0f0f0; font-size: 1.3em; margin-bottom: 1.5rem; text-shadow: 1px 1px 2px rgba(0,0,0,0.7);">
                  Junte-se a nós na missão de resgatar, cuidar e encontrar lares amorosos para animais abandonados..
              </p>
              <a href="/doacao" class="button me-2" style="background-color: var(--hc-button-text); color: var(--hc-bg-color); padding: 12px 25px; font-size: 1.1em;">Quero Doar</a>
              <a href="/adocao" class="button" style="background-color: transparent; border: 2px solid var(--hc-button-text); color: var(--hc-button-text); padding: 10px 23px; font-size: 1.1em;">Adote um Amigo</a>
          </div>
      </section>

         <!-- ==========================================================================
             Eventos (Carousel)
             ========================================================================== -->
         <section id="eventos" class="py-5">
             <div class="container">
                                 <div class="d-flex align-items-center justify-content-between mb-3">
                                     <h2 class="mb-0">Eventos</h2>
                                     <% if (typeof isAdmin !== 'undefined' && isAdmin) { %>
                                         <a href="/eventos/form" class="button btn-sm">+ Adicionar novo evento</a>
                                     <% } %>
                                 </div>
                <% const eventsList = (typeof modelEventos !== 'undefined' && modelEventos.length) ? modelEventos : ((typeof model1 !== 'undefined' && model1.length) ? model1 : []); %>
                <% if (eventsList && eventsList.length > 0) { %>
                  <div class="evt-carousel-wrapper">
                    <div id="evtFeaturedInner" class="evt-carousel-inner">
                      <% const isEventosSource = (typeof modelEventos !== 'undefined' && modelEventos.length);
                         eventsList.slice(0,8).forEach(function(event, i) { 
                           const imgSrc = isEventosSource ? ('/uploads/eventos/' + (event.arquivo || 'placeholder-event.jpg')) : ('/uploads/home/' + (event.arquivo || 'placeholder-event.jpg'));
                           const linkUrl = isEventosSource ? `/eventos/${event.id}` : `/campanha/${event.id}`;
                      %>
                        <div class="evt-feature-slide <%= i===0 ? 'active' : '' %>" data-index="<%= i %>">
                          <% if (typeof isAdmin !== 'undefined' && isAdmin) { %>
                            <% const deleteAction = isEventosSource ? `/eventos/delete/${event.id}` : `/delete/campanha/${event.id}/${event.arquivo || 'sem_arquivo'}`; %>
                            <form action="<%= deleteAction %>" method="POST" onsubmit="return confirm('Tem certeza que deseja excluir este item?');" class="evt-delete-btn">
                              <button type="submit" class="btn btn-danger btn-sm rounded-circle shadow-sm" style="width: 32px; height: 32px; padding: 0; display: flex; align-items: center; justify-content: center;" title="Excluir">
                                <i class="fas fa-times"></i>
                              </button>
                            </form>
                          <% } %>
                          <a href="<%= linkUrl %>" class="d-block w-100 h-100">
                            <img class="featured-image" loading="lazy" src="<%= imgSrc %>" alt="<%= event.titulo %>">
                          </a>
                          
                        </div>
                      <% }); %>
                      <button id="evtPrev" class="evt-nav-btn prev" aria-label="Anterior"><i class="fas fa-chevron-left"></i></button>
                      <button id="evtNext" class="evt-nav-btn next" aria-label="Próximo"><i class="fas fa-chevron-right"></i></button>
                    </div>
                    
                    <!-- Descrição fora do card -->
                    <div id="evtDescription" class="text-center mt-3 px-4" style="min-height: 4em; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border-radius: 8px; padding: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                      <% if(eventsList.length > 0) { const e = eventsList[0]; 
                         const descText = isEventosSource ? (e.descricao || '') : (e.mensagem || '');
                         const truncatedText = descText.substring(0,250);
                      %>
                        <h4 class="mb-2" style="color: var(--brand-teal); font-weight: 600; font-size: 1.2em; line-height: 1.4;">
                          <%= e.titulo %>
                        </h4>
                        <p class="mb-0" style="color: var(--text-color); line-height: 1.6; font-size: 0.95em; word-wrap: break-word; overflow-wrap: break-word;">
                          <span class="description-text"><%= truncatedText %></span>
                          <% if(descText.length > 250) { %>
                            <span class="read-more-btn" style="color: var(--brand-blue); font-weight: 500; cursor: pointer;">...ler mais</span>
                            <span class="full-text" style="display: none;"><%= descText %></span>
                          <% } %>
                        </p>
                      <% } %>
                    </div>

                    <div id="evtCount" class="text-center text-muted small mt-2">1 / <%= eventsList.slice(0,8).length %></div>
                  </div>

                  <!-- Miniaturas -->
                  <div id="evtThumbs" class="mt-3 d-flex gap-2 overflow-auto pb-2 justify-content-center justify-content-md-start" style="display: flex; flex-direction: row;">
                    <% eventsList.slice(0,8).forEach(function(event, i) { 
                         const imgSrc = isEventosSource ? ('/uploads/eventos/' + (event.arquivo || 'placeholder-event.jpg')) : ('/uploads/home/' + (event.arquivo || 'placeholder-event.jpg'));
                    %>
                      <div class="evt-thumb <%= i===0 ? 'active' : '' %>" data-index="<%= i %>">
                        <img src="<%= imgSrc %>" alt="thumb <%= i+1 %>">
                      </div>
                    <% }); %>
                  </div>
                <% } else { %>
                    <p class="text-center text-muted">Nenhum evento cadastrado no momento.</p>
                <% } %>
             </div>
         </section>

<style>
  /* Container do Carrossel */
  .evt-carousel-inner {
    position: relative;
    width: 100%;
    max-width: 1200px;
    height: 600px;
    margin: 0 auto;
    background: #f8f9fa;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
  }

   /* Slides com Fade */
   .evt-feature-slide {
     position: absolute;
     inset: 0;
     opacity: 0;
     transition: opacity 0.5s ease-in-out;
     z-index: 1;
     display: flex;
     align-items: center;
     justify-content: center;
     background: linear-gradient(135deg, #f5f5f5 0%, #e8e8e8 100%);
   }
   .evt-feature-slide.active { opacity: 1; z-index: 2; }

  .featured-image { 
    width: 50%; 
    height: 50%; 
    object-fit: contain; 
    display: block; 
    margin: auto;
    border-radius: 8px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.3);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }
  .featured-image:hover {
    transform: scale(1.05);
    box-shadow: 0 8px 30px rgba(0,0,0,0.4);
  }

  /* Controles de Navegação */
  .evt-nav-btn {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    background: rgba(0,0,0,0.3);
    color: white;
    border: none;
    width: 40px; height: 40px;
    border-radius: 50%;
    cursor: pointer;
    z-index: 10;
    transition: background 0.2s;
    display: flex; align-items: center; justify-content: center;
  }
  .evt-nav-btn:hover { background: rgba(0,0,0,0.7); }
  .evt-nav-btn.prev { left: 10px; }
  .evt-nav-btn.next { right: 10px; }

  /* Botão de Deletar */
  .evt-delete-btn { position: absolute; top: 10px; right: 10px; z-index: 20; }

  /* Miniaturas */
  .evt-thumb {
    flex: 0 0 auto;
    width: 100px; height: 70px;
    border-radius: 6px;
    overflow: hidden;
    cursor: pointer;
    opacity: 0.6;
    transition: all 0.2s;
    border: 2px solid transparent;
  }
  .evt-thumb.active { opacity: 1; border-color: var(--brand-teal, #2aa89a); transform: scale(1.05); }
  .evt-thumb img { width: 100%; height: 100%; object-fit: cover; }
  
  @media (max-width:768px){ 
    .evt-carousel-inner { height: 400px; max-width: 100%; } 
    .featured-image { max-width: 100%; max-height: 100%; }
    .evt-thumb { width: 80px; height: 60px; }
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', ()=>{
    const slides = Array.from(document.querySelectorAll('.evt-feature-slide'));
    const thumbs = Array.from(document.querySelectorAll('.evt-thumb'));
    const prev = document.getElementById('evtPrev');
    const next = document.getElementById('evtNext');
    const count = document.getElementById('evtCount');
    const descContainer = document.getElementById('evtDescription');
    let idx = 0;
    
    // Adiciona evento de clique para "ler mais/ler menos" na descrição inicial
    const readMoreBtn = descContainer?.querySelector('.read-more-btn');
    if (readMoreBtn) {
      readMoreBtn.addEventListener('click', () => {
        const descText = descContainer.querySelector('.description-text');
        const fullText = descContainer.querySelector('.full-text');
        
        if (fullText && descText) {
          if (fullText.style.display === 'none') {
            descText.style.display = 'none';
            fullText.style.display = 'inline';
            readMoreBtn.textContent = ' ler menos';
          } else {
            descText.style.display = 'inline';
            fullText.style.display = 'none';
            readMoreBtn.textContent = '...ler mais';
          }
        }
      });
    }

     function show(n){
       if(!slides.length) return;
       idx = (n + slides.length) % slides.length;
       
       // Atualiza slides (usando classes para transição CSS)
       slides.forEach((s,i) => {
         if (i === idx) {
           s.classList.add('active');
         }
         else s.classList.remove('active');
       });

       // Atualiza a descrição externa com formatação melhorada
       if (descContainer && eventsList && eventsList.length > 0) {
         const e = eventsList[idx];
         const isEventosSource = (typeof modelEventos !== 'undefined' && modelEventos.length);
         const descText = isEventosSource ? (e.descricao || '') : (e.mensagem || '');
         
         // Verifica se o texto atual está completo ou truncado
         const currentText = descContainer.querySelector('p');
         const isExpanded = currentText && currentText.textContent.includes(descText);
         
         let displayText, readMoreText;
         if (isExpanded) {
           displayText = descText.substring(0,250);
           readMoreText = descText.length > 250 ? '<span class="read-more-btn" style="color: var(--brand-blue); font-weight: 500; cursor: pointer;">...ler mais</span>' : '';
         } else {
           displayText = descText;
           readMoreText = descText.length > 250 ? '<span class="read-more-btn" style="color: var(--brand-blue); font-weight: 500; cursor: pointer;"> ler menos</span>' : '';
         }
         
         descContainer.innerHTML = `
           <h4 class="mb-2" style="color: var(--brand-teal); font-weight: 600; font-size: 1.2em; line-height: 1.4;">
             ${e.titulo}
           </h4>
           <p class="mb-0" style="color: var(--text-color); line-height: 1.6; font-size: 0.95em; word-wrap: break-word; overflow-wrap: break-word;">
             ${displayText}${readMoreText}
           </p>
         `;
         
         // Adiciona evento de clique no "ler mais/ler menos"
         const readMoreBtn = descContainer.querySelector('.read-more-btn');
         if (readMoreBtn) {
           readMoreBtn.addEventListener('click', () => {
             // Re-executa a função show com o mesmo índice para alternar
             show(idx);
           });
         }
       }

       if(count) count.textContent = (idx+1) + ' / ' + slides.length;
       
       // Atualiza thumbs
       thumbs.forEach((t,i)=> t.classList.toggle('active', i===idx));
       const activeThumb = thumbs[idx];
       if(activeThumb) activeThumb.scrollIntoView({behavior:'smooth', inline:'center', block:'nearest'});
     }

    prev?.addEventListener('click', ()=> show(idx-1));
    next?.addEventListener('click', ()=> show(idx+1));
    thumbs.forEach((t,i)=> t.addEventListener('click', ()=> show(i)));
    
    // Teclado
    document.addEventListener('keydown', e=>{ if(e.key==='ArrowLeft') show(idx-1); if(e.key==='ArrowRight') show(idx+1); });
  });
</script>
</script>




      <!-- ==========================================================================
          2. Sobre Nós (Resumido)
          ========================================================================== -->
      <section id="sobre-resumo" class="py-5">
          <div class="container">
              <div class="row align-items-center">
                  <div class="col-md-7">
                      <h2>Nossa Missão</h2>
                      <p>A ONG Amor Animal é dedicada ao resgate, reabilitação e realocação de animais em situação de vulnerabilidade. Movidos pela compaixão, trabalhamos incansavelmente para oferecer uma segunda chance a cada um deles, promovendo a posse responsável e o bem-estar animal em nossa comunidade.</p>
                         <div class="col-md-5 text-center">
                             <!-- QR CODE PORTAL DA TRANSPARENCIA -->
           <!-- <div class="container"> -->
              <fieldset style="border: 1px solid var(--border-color);  border-radius: 5px; max-width: 300px; margin: 0px auto; ">
                  <legend style="padding: 0 10px; font-weight: bold; color: var(--heading-color);">Acesse nosso Portal da Transparência</legend>
                  <img src="/static/css/imagem/transparencia.png" alt="QR Code para o Portal da Transparência" style="width: 150px; height: 150px;">
                  <p style="margin-top: 10px; color: var(--text-color);">Escaneie o QR Code ou visite <a href="https://amoranimal.ong.br/transparencia" target="_blank" style="color: var(--brand-teal); text-decoration: underline;">amoranimal.ong.br/transparencia</a></p>
              </fieldset>
           <!-- </div> -->
                     <span>Equipe ONG Amor Animal</span>
                  </div>
                  
                      <div class="text-center">
                        <a href="/sobre" class="button"" >Saiba Mais Sobre Nós</a>
                      </div>


                  </div>

              </div>

          </div>
         
      </section>

      <!-- ==========================================================================
          3. Adoção em Destaque
          ========================================================================== -->
      <section id="adocao-destaque" class="py-5">
          <div class="container">
              <h2 class="text-center mb-4">Esperando por um Lar</h2>
              <% if (typeof model2 !== 'undefined' && model2.length > 0) { %>
              <div class="home-cards-container">
                  <% model2.slice(0, 4).forEach(adocao => { %>
                  <div class="home-card card">
                      <a href="/adocao/<%= adocao.id %>">
                          <img src="/uploads/adocao/<%= adocao.arquivo || 'placeholder-pet.jpg' %>"
                               alt="Foto de <%= adocao.nome || 'pet' %> para adoção"
                               class="card-img-top home-card-img">
                      </a>
                      <div class="card-body text-center">
                          <%# Se o nome não existir, exibe a espécie com a primeira letra maiúscula. %>
                          <h5 class="card-title"><%= adocao.nome || (adocao.especie ? adocao.especie.charAt(0).toUpperCase() + adocao.especie.slice(1) : 'Pet para adoção') %></h5>

                          <%# Exibe a idade como vem do banco (ex: "1 ano e 2 meses") ou um texto padrão. %>
                          <p class="text-muted small"><%= adocao.especie %> - <%= adocao.idade || 'Idade não informada' %></p>

                          <%# O link "Conhecer" agora funciona mesmo sem nome e tem um texto alternativo. %>
                          <a href="/adocao/<%= adocao.id %>" class="button btn-sm">Conhecer <%= adocao.nome ? adocao.nome.split(' ')[0] : 'o pet' %></a>
                      </div>
                  </div>
                  <% }); %>
              </div>
              <div class="text-center mt-4">
                  <a href="/adocao" class="button">Ver Todos os Pets</a>
              </div>
              <% } else { %>
              <p class="text-center text-muted">Nenhum pet disponível para adoção no momento. Volte em breve!</p>
              <% } %>

          </div>
      </section>



      <!-- ==========================================================================
          5. Nossos Números / Impacto
          ========================================================================== -->
      <section id="numeros" class="py-5" style="background-color: var(--bg-color);">
          <div class="container">
              <h2 class="text-center mb-5">Nosso Impacto</h2>
             <div class="row text-center gy-4 justify-content-center">
                  <div class="col-lg-3 col-md-6">
                      <div class="card card-impact h-100" style="border: none; background: transparent;">
                          <div class="card-body">
                              <i class="fas fa-users fa-3x mb-3" style="color: var(--heading-color);"></i>
                              <h3 class="card-title display-4 fw-bold"><%= model15 %></h3>
                              <p class="text-muted">Voluntários</p>
                              <a href="/doacao/voluntario">Seja um.</a><br><br>


                          </div>
                      </div>
                  </div>


             <div class="row text-center gy-4 justify-content-center">
                  <div class="col-lg-3 col-md-6">
                      <div class="card card-impact h-100" style="border: none; background: transparent;">
                          <div class="card-body">
                              <i class="fas fa-users fa-3x mb-3" style="color: var(--heading-color);"></i>
                              <h3 class="card-title display-4 fw-bold"><%= model17 %></h3>
                              <p class="text-muted">Suprimentos</p>
                              <a href="/doacao/coleta/form">Doe suprimentos</a>
                          </div>
                      </div>
                  </div>

                  <div class="col-lg-3 col-md-6">
                      <div class="card card-impact h-100" style="border: none; background: transparent;">
                          <div class="card-body">
                              <i class="fas fa-paw fa-3x mb-3" style="color: var(--heading-color);"></i>
                              <h3 class="card-title display-4 fw-bold"><%= model3 %></h3>
                              <p class="text-muted">Aguardando adoção</p>
                              <a href="/adocao">Veja Mais</a>
                          </div>
                      </div>
                  </div>
                  <div class="col-lg-3 col-md-6">
                      <div class="card card-impact h-100" style="border: none; background: transparent;">
                          <div class="card-body">
                              <i class="fas fa-heart fa-3x mb-3" style="color: var(--heading-color);"></i>
                              <h3 class="card-title display-4 fw-bold"><%= model7 %></h3>
                              <p class="text-muted"> Já Adotados</p>
                              <a href="/adotado">Veja Mais</a>
                          </div>
                      </div>
                  </div>
                  <div class="col-lg-3 col-md-6">
                      <div class="card card-impact h-100" style="border: none; background: transparent;">
                          <div class="card-body">
                              <i class="fas fa-users fa-3x mb-3" style="color: var(--heading-color);"></i>
                              <h3 class="card-title display-4 fw-bold"><%= model11 %></h3>
                              <p class="text-muted"> Desaparecidos </p>
                                <a href="/procura_se">Veja Mais</a>
                          </div>
                      </div>
                  </div>
                  <div class="col-lg-3 col-md-6">
                      <div class="card card-impact h-100" style="border: none; background: transparent;">
                          <div class="card-body">
                              <i class="fas fa-hands-helping fa-3x mb-3" style="color: var(--heading-color);"></i>
                              <h3 class="card-title display-4 fw-bold"><%= model13 %></h3>
                              <p class="text-muted">Parcerias</p>
                              <a href="/parceria">Veja Mais</a>
                          </div>
                      </div>
                  </div>

                  <div class="col-lg-3 col-md-6">
                     <div class="card card-impact h-100" style="border: none; background: transparent;">
                         <div class="card-body d-flex flex-column text-center">
                             <i class="fas fa-syringe fa-3x mb-3" style="color: var(--heading-color);"></i>
                             <h3 class="card-title h4 fw-bold">Castrações Anuais</h3>
*                             <p class="text-muted mt-n2 mb-3">Progresso do ano atual</p>

                             <%
                             const annualCounts = {};
                             if (typeof model8 !== 'undefined' && model8.length > 0) {
                                 model8.forEach(castracao => {
                                     if (castracao.origem) {
                                         const year = new Date(castracao.origem).getFullYear();
                                         annualCounts[year] = (annualCounts[year] || 0) + 1;
                                     }
                                 });
                             }

                             const sortedYears = Object.keys(annualCounts).map(Number).sort((a, b) => b - a);
                             const currentYear = sortedYears.length > 0 ? sortedYears[0] : new Date().getFullYear();
                             const previousYear = sortedYears.length > 1 ? sortedYears[1] : currentYear - 1;

                             const currentYearCount = annualCounts[currentYear] || 0;
                             const previousYearCount = annualCounts[previousYear] || 0;

                             let comparisonText = `Total em ${previousYear}: ${previousYearCount}`;
                             let comparisonColor = 'text-muted';
                             let icon = '';

                             if (previousYearCount > 0) {
                                 const percentageChange = ((currentYearCount - previousYearCount) / previousYearCount) * 100;
                                 if (percentageChange > 0) {
                                     icon = '<i class="fas fa-arrow-up"></i> ';
                                     comparisonText = `${icon}${percentageChange.toFixed(0)}% vs ${previousYear}`;
                                     comparisonColor = 'text-success';
                                 } else if (percentageChange < 0) {
                                     icon = '<i class="fas fa-arrow-down"></i> ';
                                     comparisonText = `${icon}${Math.abs(percentageChange.toFixed(0))}% vs ${previousYear}`;
                                     comparisonColor = 'text-danger';
                                 } else {
                                     comparisonText = `Igual a ${previousYear}`;
                                 }
                             } else if (currentYearCount > 0) {
                                 comparisonText = `Primeiros registros em ${currentYear}`;
                             } else {
                                 comparisonText = "Sem dados para comparar";
                             }
                             %>

                             <div class="my-auto">
                                 <div class="display-4 fw-bold" style="color: var(--heading-color);"><%= currentYearCount %></div>
                                 <div class="fw-bold <%= comparisonColor %>"><%- comparisonText %></div>
                                 <small class="text-muted">em <%= currentYear %></small>
                                 </div>
                              <a href="/castracao/lista" class="mt-3">Veja Mais</a>
                         </div>
                     </div>
                 </div>

                 <div class="col-lg-3 col-md-6">
                     <div class="card card-impact h-100" style="border: none; background: transparent;">
                         <div class="card-body">
                             <i class="fas fa-ticket-alt fa-3x mb-3" style="color: var(--heading-color);"></i> <!-- Ícone alterado para ticket -->
                              <div class="text-end mb-4">
    <a href="/castracao/form" class="btn btn-primary">
    <i class="fas fa-plus me-1"></i> Agendar Nova Castração
    </a>
    </div>

                             <h3 class="card-title h4 fw-bold">Agendamentos de Castração</h3> <!-- Ajustado para h4 para não competir com os números grandes -->
                             <div class="table-responsive">
                                 <table class="table table-striped table-hover table-sm caption-top">
                                     <thead>
                                         <tr>
                                             <th>Ticket</th>
                                             <th>Nome</th>
                                             <th>Espécie</th>
                                             <th>Clínica</th>
                                             <th>Data</th>
                                             <th>Status</th>
                                             <th>Ações</th>
                                             <% if (user) { %>
                                                 <th>Excluir</th>
                                             <% } %>
                                             <th>Detalhes</th>
                                         </tr>
                                     </thead>
                                     <tbody>
                                         <% if (typeof model8 !== 'undefined' && model8.length > 0) { %>
                                             <% model8.slice(0, 5).forEach(castracao => { %>
                                                 <tr>
                                                     <td style="color:brown; font-size: large;"><%= castracao.ticket %></td>
                                                     <td><%= castracao.nome %></td>
                                                     <td><%= castracao.especie %></td>
                                                     <td><%= castracao.clinica %></td>
                                                     <td><%= castracao.origem ? new Date(castracao.origem).toLocaleDateString('pt-BR') : 'N/A' %></td>
                                                     <%
                                                         const rawStatus = (castracao && castracao.status) ? String(castracao.status).trim().toUpperCase() : 'PENDENTE';
                                                         const isPending = rawStatus === 'PENDENTE';
                                                     %>
                                                     <td>
                                                         <span class="<%= isPending ? 'text-warning' : 'text-success' %>"><%= isPending ? 'Pendente' : 'Atendido' %></span>
                                                     </td>

                                                     <td class="action-buttons text-center">
                                                         <% if (isPending) { %>
                                                             <form action="/castracao/updateStatus/<%= castracao.id %>" method="post">
                                                                 <button type="submit" class="btn btn-success btn-sm" title="Atender">Atender</button>
                                                             </form>
                                                         <% } else { %>
                                                             <span class="text-success">-</span>
                                                         <% } %>
                                                        <% if (user) { %>
                                                            <form action="/castracao/delete/<%= castracao.id %>/<%= castracao.arquivo || 'sem_arquivo' %>" method="post" class="d-inline" onsubmit="return confirm('Deseja realmente excluir este agendamento')">
                                                                <button type="submit" class="btn btn-danger btn-sm" title="Excluir Agendamento">
                                                                    <i class="fas fa-trash-alt"></i>
                                                                    <span class="visually-hidden">Excluir</span>
                                                                </button>
                                                            </form>
                                                        <% } %>
                                                     </td>

                                                    <td>
                                                        <a href="/castracao/<%= castracao.id %>" class="btn btn-info btn-sm">Detalhes</a>
                                                    </td>
                                                </tr>

                                             <% }); %>
                                         <% } else { %>
                                             <tr><td colspan="6" class="text-center text-muted">Nenhum ticket de castração para exibir no momento.</td></tr>
                                         <% } %>
                                     </tbody>
                                 </table>


                     </div>
                 </div>
                  <style>
                    .table-responsive { overflow-x: auto; }
                  </style>


             </div> <!-- Fechamento do .row principal da seção de impacto -->
          </div>
      </section>

      <!-- ==========================================================================
          6. Histórias de Adotados
          ========================================================================== -->
      <section id="historias-adotados" class="py-5">
          <div class="container">
              <h2 class="text-center mb-4">Histórias que Inspiram</h2>
              <% if (typeof model6 !== 'undefined' && model6.length > 0) { %>
              <div class="adotados-cards-container">
                  <% model6.slice(0, 3).forEach(adotado => { %>
                  <div class="adotado-card card">
                      <img src="/uploads/adotado/<%= adotado.arquivo || 'placeholder-pet-story.jpg' %>"
                           alt="Foto de <%= adotado.pet %>, adotado por <%= adotado.tutor %>"
                           class="card-img-top adotado-card-img">
                      <div class="card-body">
                          <h5 class="card-title"><%= adotado.pet %></h5>
                          <h6 class="card-subtitle mb-2 text-muted">Adotado por: <%= adotado.tutor %></h6>
                          <p class="card-text adotado-historia-texto">"<%= adotado.historia %>"</p>
                          <small class="text-muted">Em: <%= adotado.origem ? new Date(adotado.origem).toLocaleDateString('pt-BR', { year: 'numeric', month: 'long', day: 'numeric' }) : 'Data não informada' %></small>
                      </div>
                  </div>
                  <% }); %>
              </div>
              <div class="text-center mt-4">
                  <a href="/adotado" class="button">Ver Todas as Histórias</a>
                  <a href="/adotado/form" class="button ms-2">Adicionar História</a>
              </div>
              <% } else { %>
              <p class="text-center text-muted">Ainda não temos histórias de adoção para compartilhar. Seja o primeiro!</p>
              <% if (user) { %>
                  <div class="text-center mt-3"><a href="/adotado/form" class="button">Adicionar História</a></div>
              <% } %>
              <% } %>

          </div>
      </section>

       <!-- ==========================================================================
          7. Procura-se
          ========================================================================== -->

          <section id="procura_se" class="py-5 bg-light"> <!-- Adicionado bg-light para alternar cor -->
              <div class="container">
                  <h2 class="text-center mb-4">Procura-se!</h2>

                  <% if (typeof model10 !== 'undefined' && model10.length > 0) { %>
                  <div class="procura-se-cards-container">
                      <% model10.slice(0, 3).forEach(procura_se => { %>
                      <div class="procura-se-card card">
                          <img src="/uploads/procura_se/<%= procura_se.arquivo || 'placeholder-procura-se.jpg' %>"
                               alt="Foto de <%= procura_se.nomePet %>, animal desaparecido"
                               class="card-img-top procura-se-card-img">
                          <div class="card-body text-center">
                              <h5 class="card-title"><%= procura_se.nomePet %></h5>
                              <p class="text-muted small"><%= procura_se.especie %> - <%= procura_se.caracteristicas %></p>
                              <p><%= procura_se.descricao %></p>
                              <a href="/procura_se/<%= procura_se.id %>" class="button btn-sm">Mais Detalhes</a>
                          </div>
                      </div>
                      <% }); %>
                  </div>
                  <div class="text-center mt-4">
                      <a href="/procura_se" class="button">Ver Todos</a>
                  </div>
                  <% } else { %>
                  <p class="text-center text-muted">Nenhum animal desaparecido listado no momento.</p>
                  <% } %>
              </div>
          </section>

          <!-- ==========================================================================
          8. Parcerias
          ========================================================================== -->


         <section id="parcerias" class="py-5"> <!-- Removido bg-light para alternar cor -->
             <div class="container">
                 <div class="d-flex justify-content-between align-items-center mb-4">
                     <h2 class="text-center flex-grow-1 mb-0">Nossos Parceiros</h2> <!-- flex-grow-1 e mb-0 para centralizar melhor com o botão -->

                 </div>

                 <% if (typeof model12 !== 'undefined' && model12.length > 0) { %>
                 <div class="parcerias-scroll-container">
                     <div class="scroll-content">
                     <% model12.forEach(parceria => { %>
                         <div class="card parceria-item d-inline-block me-3 shadow-sm" style="width: 250px; vertical-align: top;">
                             <!-- Se houver imagem da parceria, poderia ser adicionada aqui -->
                             <!-- <img src="/uploads/parceria/<%= parceria.arquivo %>" class="card-img-top" alt="Logo <%= parceria.empresa %>"> -->
                             <div class="card-body text-center">
                                 <h5 class="card-title"><%= parceria.empresa %></h5>
                                 <p class="card-text text-muted small"><%= parceria.proposta %></p>
                                 <% if (parceria.link) { %>
                                     <a href="<%= parceria.link.startsWith('http') ? parceria.link : '//' + parceria.link %>" target="_blank" rel="noopener noreferrer" class="btn btn-sm btn-outline-secondary mt-2">Visitar Site</a>
                                 <% } %>
                                  <% if (user) { %>
                                     <div class="mt-2">
                                         <form action="/delete/parceria/<%= parceria.id %>/<%= parceria.arquivo %>" method="post" class="d-inline" onsubmit="return confirm('Deseja realmente excluir esta parceria?')">
                                         <button type="submit" class="btn btn-danger btn-sm" title="Excluir Parceria">
                                             <i class="fas fa-trash-alt"></i>
                                             <span class="visually-hidden">Excluir</span>
                                         </button>
                                         </form>
                                     </div>
                                 <% } %>
                             </div>
                         </div>
                     <% }); %>
                     </div>
                 </div>
                 <% } else { %>
                 <p class="text-center text-muted">Ainda não temos parceiros listados.</p>
                  <% if (user) { %>
                          <div class="text-center mt-3"><a href="/parceria/form" class="button">Adicionar Parceria</a></div>
                      <% } %>
                 <% } %>
             </div>
         </section>

          <!-- ==========================================================================
          9. Como Ajudar / Chamada Final
          ========================================================================== -->
          <section id="como-ajudar-final" class="py-5 bg-light">
             <div class="container text-center">
                 <h2 class="mb-4">Faça Parte da Mudança</h2>
                 <p style="font-size: 1.1em; margin-bottom: 2rem;">
                     Sua ajuda, seja como voluntário, parceiro ou doador, é fundamental para continuarmos nosso trabalho.
                 </p>
                 <div>
                     <a href="/doacao/voluntario/interesse/form" class="button me-2">Quero ser Voluntário</a>
                     <a href="/parceria/form" class="button me-2">Seja um Parceiro</a>
                     <a href="/doacao" class="button">Faça uma Doação</a>
                 </div>
             </div>
         </section>

  </main>

  <%- include("_footer") -%>
